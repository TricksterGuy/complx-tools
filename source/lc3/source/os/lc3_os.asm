.orig x0000
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill GETC_TRAP
.fill OUT_TRAP
.fill PUTS_TRAP
.fill IN_TRAP
.fill PUTSP_TRAP
.fill HALT_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill UNKNOWN_TRAP
.fill PRIVILEGE_EXC ; IVT
.fill ILLEGAL_EXC
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill KB_INT
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
UNKNOWN_TRAP LEA R0, UNKNOWN_TRAP_EXC
PUTS
HALT
GETC_TRAP LDI R0, KBSR
BRZP GETC_TRAP
LDI R0, KBDR
RET
OUT_TRAP ST R1, R1SAVE
OUT_TRAP_POLL LDI R1, DSR
BRZP OUT_TRAP_POLL
STI R0, DDR
LD R1, R1SAVE
RET
PUTS_TRAP ST R0, R0SAVE
ST R2, R2SAVE
ST R7, R7SAVE
ADD R2, R0, #0
PUTS_TRAP_CHAR LDR R0, R2, #0
BRZ PUTS_TRAP_DONE
OUT
ADD R2, R2, #1
BR PUTS_TRAP_CHAR
PUTS_TRAP_DONE LD R0, R0SAVE
LD R2, R2SAVE
LD R7, R7SAVE
RET
IN_TRAP LEA R0, IN_PROMPT
ST R2, R2SAVE
ST R7, R7SAVE
ADD R2, R0, #0
IN_TRAP_CHAR LDR R0, R2, #0
BRZ IN_TRAP_DONE
OUT
ADD R2, R2, #1
BR IN_TRAP_CHAR
IN_TRAP_DONE GETC
OUT
LD R2, R2SAVE
LD R7, R7SAVE
RET
PUTSP_TRAP ST R0, R0SAVE
ST R2, R2SAVE
ST R3, R3SAVE
ST R4, R4SAVE
ST R7, R7SAVE
ADD R2, R0, #0
PUTSP_GET_DATA LDR R0, R2, #0
ADD R3, R0, #0
LD R0, MASK_FF
AND R0, R3, R0
BRZ PUTSP_END
OUT
AND R0, R0, #0
AND R4, R4, #0
ADD R4, R4, #8
PUTSP_SHIFT ADD R0, R0, R0
AND R3, R3, R3
BRZP PUTSP_MSB_POS
ADD R0, R0, #1
PUTSP_MSB_POS ADD R3, R3, R3
ADD R4, R4, #-1
BRP PUTSP_SHIFT
AND R0, R0, R0
BRZ PUTSP_END
OUT
ADD R2, R2, #1
BR PUTSP_GET_DATA
PUTSP_END LD R0, R0SAVE
LD R2, R2SAVE
LD R3, R3SAVE
LD R4, R4SAVE
LD R7, R7SAVE
RET
HALT_TRAP AND R7, R7, #0
STI R7, MCR
UNKNOWN_TRAP_EXC .stringz "\n---Unknown trap executed---\n"
IN_PROMPT .stringz "Input character: "
KBSR .fill xfe00
KBDR .fill xfe02
DSR .fill xfe04
DDR .fill xfe06
MCR .fill xfffe
MASK_FF .fill x00ff
STR R7, R7, #-1
R0SAVE .fill x0000
R1SAVE .fill x0000
R2SAVE .fill x0000
R3SAVE .fill x0000
R4SAVE .fill x0000
R7SAVE .fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
.fill x0000
PRIVILEGE_EXC LEA R0, PRIVILEGE_EXC_MSG
PUTS
HALT
ILLEGAL_EXC LEA R0, ILLEGAL_EXC_MSG
PUTS
HALT
PRIVILEGE_EXC_MSG .stringz "Privelege mode violation. Halting\n"
ILLEGAL_EXC_MSG .stringz "Illegal opcode violation. Halting\n"
KB_INT ADD R6, R6, #-1
STR R0, R6, #0
LDI R0, KBDR
OUT
LDR R0, R6, #0
ADD R6, R6, #1
END RTI
.end